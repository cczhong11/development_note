<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/favicon.ico"/><title>File_system</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="File_system"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://notes.tczhong.com/notes/09956453-4cbd-4f15-a4bd-b1f6c84449a4/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="5/3/2021"/><meta property="article:modified_time" content="5/12/2021"/><link rel="canonical" href="https://notes.tczhong.com/notes/09956453-4cbd-4f15-a4bd-b1f6c84449a4/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/8e7b7e4bce421c0a.css" as="style"/><link rel="stylesheet" href="/_next/static/css/8e7b7e4bce421c0a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/_next/static/chunks/webpack-3d209faeb64f2f97.js" defer=""></script><script src="/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/_next/static/chunks/main-104451f3d1a5c4bc.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6b338472289fe290.js" defer=""></script><script src="/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/_next/static/2XI28xCTA7nnAuXRumXG6/_buildManifest.js" defer=""></script><script src="/_next/static/2XI28xCTA7nnAuXRumXG6/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="file_system">File_system<a aria-hidden="true" class="anchor-heading icon-link" href="#file_system"></a></h1>
<p><a href="/notes/b1e1dad4-5179-4629-af74-208cef96a55e">Io</a></p>
<p>the in-memory data structure vnode is just an inode cache that stores information about the file(typically inode stores in the disk) so that it can be accessed more quickly.</p>
<p><img src="/assets/images/2021-05-11-19-41-30.png"></p>
<h1 id="file-system">file system<a aria-hidden="true" class="anchor-heading icon-link" href="#file-system"></a></h1>
<p><img src="/assets/images/2021-05-11-19-43-14.png"></p>
<ul>
<li>
<p>The boot block occupies the beginning of a file system, typically the first sector, and may contain the bootstrap code that is read into the machine to boot, or initialize, the operating system. Although only one boot block is needed to boot the system, every file system has a (possibly empty) boot block.</p>
</li>
<li>
<p>The super block describes the state of a file system â€” how large it is, how many files it can store, where to find free space on the file system, and other information.</p>
</li>
<li>
<p>The mode list is a list of Modes that follows the super block in the file system. Administrators specify the size of the Mode list when configuring a file system. The kernel references Modes by index into the Mode list. One Mode is the root mode of the file system: it is the Mode by which the directory structure of the file system is accessible after execution of the mount system call (Section 5.14).</p>
</li>
<li>
<p>The data blocks start at the end of the Mode list and contain file data and administrative data. An allocated data block can belong to one and only one file in the file system.</p>
</li>
</ul>
<h2 id="inode">inode<a aria-hidden="true" class="anchor-heading icon-link" href="#inode"></a></h2>
<p>Modes exist in a static form on disk, and the kernel reads them into an in-core mode to manipulate them. Disk modes consist of the following fields</p>
<ul>
<li>file owner identifier</li>
<li>file type</li>
<li>file access permission</li>
<li>access time, last modified, last accessed</li>
<li>number of links to the file</li>
<li>table of contents for the disk addresses of data in a file</li>
<li>file size</li>
<li>no path</li>
</ul>
<h2 id="structure-of-a-regular-file">STRUCTURE OF A REGULAR FILE<a aria-hidden="true" class="anchor-heading icon-link" href="#structure-of-a-regular-file"></a></h2>
<p>the Mode contains the table of contents to locate a file's data on disk. Since each block on a disk is addressable by number, the table of contents consists of a set of disk block numbers.</p>
<p>For greater flexibility, the kernel allocates file space one block at a time and allows the data in a file to be spread throughout the file system.</p>
<p>To access the data via the indirect block, the kernel must read the indirect block, find the appropriate direct block entry, and then read the direct block to find the data.</p>
<p><img src="/assets/images/2021-05-11-19-58-08.png"></p>
<h2 id="directories">directories<a aria-hidden="true" class="anchor-heading icon-link" href="#directories"></a></h2>
<p>A directory is a file whose data is a sequence of entries, each consisting of an mode number and the name of a file contained in the directory.</p>
<p><img src="/assets/images/2021-05-11-20-05-57.png"></p>
<h2 id="ls">ls<a aria-hidden="true" class="anchor-heading icon-link" href="#ls"></a></h2>
<pre><code>-rwxrw-r--    10    root   root 2048    Jan 13 07:11 afile.exe
?UUUGGGOOOS   00  UUUUUU GGGGGG ####    ^-- date stamp and file name are obvious ;-)
^ ^  ^  ^ ^    ^      ^      ^    ^
| |  |  | |    |      |      |    \--- File Size
| |  |  | |    |      |      \-------- Group Name (for example, Users, Administrators, etc)
| |  |  | |    |      \--------------- Owner Acct
| |  |  | |    \---------------------- Link count (what constitutes a "link" here varies)
| |  |  | \--------------------------- Alternative Access (blank means none defined, anything else varies)
| \--\--\----------------------------- Read, Write and Special access modes for [U]ser, [G]roup, and [O]thers (everyone else)
\------------------------------------- File type flag
</code></pre>
<h2 id="conversion-of-a-path-name-to-an-innode">conversion of a path name to an innode<a aria-hidden="true" class="anchor-heading icon-link" href="#conversion-of-a-path-name-to-an-innode"></a></h2>
<p><img src="/assets/images/2021-05-11-20-12-36.png"></p>
<p>The kernel does a linear search of the directory file associated with the working mode, trying to match the path name component to a directory entry name.</p>
<hr>
<strong>Children</strong>
<ol>
<li><a href="/notes/q5vgjkobycnonv4tbi6xz23">Linux</a></li>
</ol></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#file-system" title="File System">File System</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#inode" title="Inode">Inode</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#structure-of-a-regular-file" title="Structure Of A Regular File">Structure Of A Regular File</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#directories" title="Directories">Directories</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#ls" title="Ls">Ls</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#conversion-of-a-path-name-to-an-innode" title="Conversion Of A Path Name To An Innode">Conversion Of A Path Name To An Innode</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"09956453-4cbd-4f15-a4bd-b1f6c84449a4","title":"File_system","vault":{"fsPath":"repos/dendron-aws-vault","remote":{"type":"git","url":"https://github.com/cczhong11/my_note.git"},"name":"my_note"},"type":"note","desc":"","links":[{"type":"wiki","from":{"fname":"development.system.file_system","id":"09956453-4cbd-4f15-a4bd-b1f6c84449a4","vaultName":"my_note"},"value":"development.computer.io","alias":"Io","position":{"start":{"line":2,"column":1,"offset":1},"end":{"line":2,"column":49,"offset":49},"indent":[]},"xvault":true,"to":{"fname":"development.computer.io","vaultName":"my_note"}}],"anchors":{"file-system":{"type":"header","value":"file-system","line":14,"column":0},"inode":{"type":"header","value":"inode","line":26,"column":0},"structure-of-a-regular-file":{"type":"header","value":"structure-of-a-regular-file","line":39,"column":0},"directories":{"type":"header","value":"directories","line":49,"column":0},"ls":{"type":"header","value":"ls","line":55,"column":0},"conversion-of-a-path-name-to-an-innode":{"type":"header","value":"conversion-of-a-path-name-to-an-innode","line":70,"column":0}},"fname":"development.system.file_system","updated":1620791771392,"created":1620080210690,"parent":"62daf50d-a39e-463f-aabd-be53790281fd","children":["q5vgjkobycnonv4tbi6xz23"],"data":{},"custom":{},"contentHash":"2fd595333427c87ebf577744860fc75e"},"body":"\u003ch1 id=\"file_system\"\u003eFile_system\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#file_system\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e\u003ca href=\"/notes/b1e1dad4-5179-4629-af74-208cef96a55e\"\u003eIo\u003c/a\u003e\u003c/p\u003e\n\u003cp\u003ethe in-memory data structure vnode is just an inode cache that stores information about the file(typically inode stores in the disk) so that it can be accessed more quickly.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-05-11-19-41-30.png\"\u003e\u003c/p\u003e\n\u003ch1 id=\"file-system\"\u003efile system\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#file-system\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-05-11-19-43-14.png\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eThe boot block occupies the beginning of a file system, typically the first sector, and may contain the bootstrap code that is read into the machine to boot, or initialize, the operating system. Although only one boot block is needed to boot the system, every file system has a (possibly empty) boot block.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe super block describes the state of a file system â€” how large it is, how many files it can store, where to find free space on the file system, and other information.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe mode list is a list of Modes that follows the super block in the file system. Administrators specify the size of the Mode list when configuring a file system. The kernel references Modes by index into the Mode list. One Mode is the root mode of the file system: it is the Mode by which the directory structure of the file system is accessible after execution of the mount system call (Section 5.14).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eThe data blocks start at the end of the Mode list and contain file data and administrative data. An allocated data block can belong to one and only one file in the file system.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"inode\"\u003einode\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#inode\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eModes exist in a static form on disk, and the kernel reads them into an in-core mode to manipulate them. Disk modes consist of the following fields\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003efile owner identifier\u003c/li\u003e\n\u003cli\u003efile type\u003c/li\u003e\n\u003cli\u003efile access permission\u003c/li\u003e\n\u003cli\u003eaccess time, last modified, last accessed\u003c/li\u003e\n\u003cli\u003enumber of links to the file\u003c/li\u003e\n\u003cli\u003etable of contents for the disk addresses of data in a file\u003c/li\u003e\n\u003cli\u003efile size\u003c/li\u003e\n\u003cli\u003eno path\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"structure-of-a-regular-file\"\u003eSTRUCTURE OF A REGULAR FILE\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#structure-of-a-regular-file\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003ethe Mode contains the table of contents to locate a file's data on disk. Since each block on a disk is addressable by number, the table of contents consists of a set of disk block numbers.\u003c/p\u003e\n\u003cp\u003eFor greater flexibility, the kernel allocates file space one block at a time and allows the data in a file to be spread throughout the file system.\u003c/p\u003e\n\u003cp\u003eTo access the data via the indirect block, the kernel must read the indirect block, find the appropriate direct block entry, and then read the direct block to find the data.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-05-11-19-58-08.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"directories\"\u003edirectories\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#directories\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003eA directory is a file whose data is a sequence of entries, each consisting of an mode number and the name of a file contained in the directory.\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-05-11-20-05-57.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"ls\"\u003els\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#ls\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e-rwxrw-r--    10    root   root 2048    Jan 13 07:11 afile.exe\n?UUUGGGOOOS   00  UUUUUU GGGGGG ####    ^-- date stamp and file name are obvious ;-)\n^ ^  ^  ^ ^    ^      ^      ^    ^\n| |  |  | |    |      |      |    \\--- File Size\n| |  |  | |    |      |      \\-------- Group Name (for example, Users, Administrators, etc)\n| |  |  | |    |      \\--------------- Owner Acct\n| |  |  | |    \\---------------------- Link count (what constitutes a \"link\" here varies)\n| |  |  | \\--------------------------- Alternative Access (blank means none defined, anything else varies)\n| \\--\\--\\----------------------------- Read, Write and Special access modes for [U]ser, [G]roup, and [O]thers (everyone else)\n\\------------------------------------- File type flag\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"conversion-of-a-path-name-to-an-innode\"\u003econversion of a path name to an innode\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#conversion-of-a-path-name-to-an-innode\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-05-11-20-12-36.png\"\u003e\u003c/p\u003e\n\u003cp\u003eThe kernel does a linear search of the directory file associated with the working mode, trying to match the path name component to a directory entry name.\u003c/p\u003e\n\u003chr\u003e\n\u003cstrong\u003eChildren\u003c/strong\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"/notes/q5vgjkobycnonv4tbi6xz23\"\u003eLinux\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e","noteIndex":{"id":"0f1b48c7-3a25-4016-83a5-15864d7803ad","title":"Development","vault":{"fsPath":"repos/dendron-aws-vault","remote":{"type":"git","url":"https://github.com/cczhong11/my_note.git"},"name":"my_note"},"type":"note","desc":"","links":[{"from":{"fname":"root","id":"c95dc4f5-23db-45e7-a15b-64582a183ccc","vaultName":"my_note"},"type":"backlink","position":{"start":{"line":8,"column":3,"offset":63},"end":{"line":8,"column":21,"offset":81},"indent":[]},"value":"development"}],"anchors":{},"fname":"development","updated":1618381238346,"created":1612940782409,"parent":null,"children":["400115e9-30f7-4a13-9776-db059bc9cd42","xsX5v3ZsyJ0i6gf9","1bc3b45a-b6f4-4150-87d3-5bd5b6eb8c24","6cea4852-6e7c-4140-b476-85c07b48a642","a40ef849-d301-4d74-a778-e6d9469dfb5d","09d9081f-3dff-453d-8488-7d2344cc8895","p11phg7nb10yw0wck1fyagq","92917ea3-452e-48dc-875e-5cd0002041db","2e151826-cb22-4d89-8ce0-71dad7204ce8","baa39444-0da9-4c55-8df7-2a6f8f787fa4","q4um3bc3st86ilkkvdjom6x","62daf50d-a39e-463f-aabd-be53790281fd","3524d0a7-be73-45d6-847e-c970f5c1c760","eac0f243-05b3-4b95-bec3-848e33edbc40","nc777xa48letazo00100hin"],"data":{},"custom":{"nav_order":0,"permalink":"/"},"body":"\n","contentHash":"38357962f5a50c6fd7d318dfa66bea90"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"previewV2Enabled":false,"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2,"vaultSelectionModeOnCreate":"smart"}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"dendronVersion":"0.90.0","vaults":[{"fsPath":"repos/dendron-aws-vault","remote":{"type":"git","url":"https://github.com/cczhong11/my_note.git"},"name":"my_note"},{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableUserTags":true,"enableHashTags":true,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link","taskCompleteStatus":["done","x"]},"enableEditorDecorations":true,"enableHandlebarTemplates":true,"enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["development","life"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"my_note","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"lookup","enableMermaid":true,"siteUrl":"https://notes.tczhong.com","siteFaviconPath":"favicon.ico","siteIndex":"development"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"09956453-4cbd-4f15-a4bd-b1f6c84449a4"},"buildId":"2XI28xCTA7nnAuXRumXG6","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>