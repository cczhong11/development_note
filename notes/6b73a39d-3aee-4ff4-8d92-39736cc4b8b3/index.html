<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>Networklayer</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Networklayer"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://notes.tczhong.com/notes/6b73a39d-3aee-4ff4-8d92-39736cc4b8b3/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="3/15/2021"/><meta property="article:modified_time" content="4/12/2021"/><link rel="canonical" href="https://notes.tczhong.com/notes/6b73a39d-3aee-4ff4-8d92-39736cc4b8b3/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/_next/static/css/35c8e98bba5d4075.css" as="style"/><link rel="stylesheet" href="/_next/static/css/35c8e98bba5d4075.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-378e68e29c265886.js" defer=""></script><script src="/_next/static/chunks/framework-dc33c0b5493501f0.js" defer=""></script><script src="/_next/static/chunks/main-a7fe8c0ea9a0f989.js" defer=""></script><script src="/_next/static/chunks/pages/_app-fdb9297d37c44607.js" defer=""></script><script src="/_next/static/chunks/155-4c900bf5c5278e05.js" defer=""></script><script src="/_next/static/chunks/pages/notes/%5Bid%5D-ebe33fbe56ae1215.js" defer=""></script><script src="/_next/static/qHbm4vS5s7hFBo6UvcS91/_buildManifest.js" defer=""></script><script src="/_next/static/qHbm4vS5s7hFBo6UvcS91/_ssgManifest.js" defer=""></script><script src="/_next/static/qHbm4vS5s7hFBo6UvcS91/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div class="ant-col"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"></div><div style="margin-left:4px;display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout site-layout" style="margin-top:64px"><section class="ant-layout site-layout" style="flex-direction:row"><section class="ant-layout site-layout-sidebar" style="flex:0 0 auto;width:calc((100% - 992px) / 2 + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></section><section class="ant-layout side-layout-main" style="max-width:960px;display:initial"><main class="ant-layout-content main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-20"><div><h1 id="networklayer"><a aria-hidden="true" class="anchor-heading" href="#networklayer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Networklayer</h1>
<h1 id="network-layer"><a aria-hidden="true" class="anchor-heading" href="#network-layer"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>network layer</h1>
<p>ip</p>
<p><strong>transfer packets across links</strong>, addressing scale to large networks, routing protocol determines best paths across the network</p>
<h2 id="ip"><a aria-hidden="true" class="anchor-heading" href="#ip"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>IP</h2>
<p>addressing mechanism: IP ADDRESS </p>
<ul>
<li>No call setup at network layer</li>
<li>Packets are forwarded using address of the destination host</li>
<li>Packets are forwarded independently</li>
<li>Packets between same source-dest pair may take different paths</li>
<li>addressing
<ul>
<li>Each end-host has unique address</li>
<li>Forwarding table maps addresses to outgoing link</li>
</ul>
</li>
</ul>
<h3 id="packet"><a aria-hidden="true" class="anchor-heading" href="#packet"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>packet</h3>
<ul>
<li>data types: packet
<ul>
<li>On sending side, encapsulate segment into packets</li>
<li>Transmit the packet through the network</li>
<li>Network layer protocols exist on all routers (and hosts) for this purpose</li>
<li>On receiving side, deliver packets to transport layer</li>
</ul>
</li>
</ul>
<h3 id="routing"><a aria-hidden="true" class="anchor-heading" href="#routing"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>routing</h3>
<ul>
<li>Routing (Control Plane)
<ul>
<li><strong>Involves all routers in a network</strong></li>
<li>Creates a <strong>forwarding</strong> table to determine end-to-end paths taken by packets</li>
<li>Uses routing algorithms</li>
</ul>
</li>
<li>Forwarding (Data Plane)
<ul>
<li>Move packets from router’s incoming interface to appropriate outgoing interface</li>
<li>An action in a single router</li>
<li>use forwarding table</li>
</ul>
</li>
<li>Connection Setup: setup route states before sending packets</li>
</ul>
<h3 id="format"><a aria-hidden="true" class="anchor-heading" href="#format"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>format</h3>
<ul>
<li>packet-handling operations at each router
<ul>
<li>forward with destination of address</li>
<li>forward independently</li>
</ul>
</li>
<li>format
<ul>
<li>Version specifies IPv4</li>
<li>Header length (in 32-bit words)</li>
<li>Type of Service</li>
<li>Datagram length (Header + data) 20bytes+data</li>
<li>ID, Flags, Offset: Used for fragmentation at router
<ul>
<li>1 DF Don't fragament</li>
<li>2 MF more fragament</li>
<li>ID unique</li>
</ul>
</li>
<li>Time-to-Live: Decremented at each router, Datagram dropped if zero</li>
<li>Protocol
<ul>
<li>Used by receiver to determine which transport protocol should get packet</li>
</ul>
</li>
<li>Header checksum: Calculated only on header
<ul>
<li>Must be recomputed at each router: because ttl changes</li>
</ul>
</li>
<li>use checksum because other protocol maybe involved</li>
<li>Data: Encapsulated TCP/UDP segment . ICMP data</li>
</ul>
</li>
</ul>
<h3 id="ipv4"><a aria-hidden="true" class="anchor-heading" href="#ipv4"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>ipv4</h3>
<ul>
<li>prefix notation: range of subnet 128.2.101.64/26
<ul>
<li>6 bit free</li>
<li>example: 223.1.17.0/25 for /24 half, 223.1.17.128/26 for 64, 223.1.17.192/26 for 64</li>
</ul>
</li>
<li>forwarding tables:
<ul>
<li>put prefix matching in destination prefix</li>
<li>match the leading bits of destination address to the longest listed prefix: <strong>longest matching prefix rule</strong></li>
</ul>
</li>
<li>CIDR classless interdomain routing</li>
</ul>
<p><img src="/assets/images/2021-03-25-16-00-27.png"></p>
<p><img src="/assets/images/2021-03-25-16-14-19.png"></p>
<h3 id="icmp"><a aria-hidden="true" class="anchor-heading" href="#icmp"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>ICMP</h3>
<ul>
<li>single ip packet
<ul>
<li>no reliability</li>
<li>type/ code for echo/unreachable....</li>
</ul>
</li>
<li>traceroute:
<ul>
<li>send nth udp segments has TTL of n</li>
<li>replies with ICMP time exceeded</li>
</ul>
</li>
<li>is a network-layer protocol
<ul>
<li>Messages used for communication between routers and end-hosts</li>
<li>Messages sent in an IP packet - Just like a UDP segment</li>
<li>Messages require special processing by the IP layer software on each router</li>
</ul>
</li>
</ul>
<h3 id="forwarding-table"><a aria-hidden="true" class="anchor-heading" href="#forwarding-table"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>forwarding table</h3>
<p>dijkstra</p>
<p><img src="/assets/images/2021-04-11-21-58-17.png"></p>
<ul>
<li>每次更新新加入的点到未加入点的距离。每次从未加入点中选一个距离到已加入的set里最小的
<ul>
<li>short path tree</li>
<li>use dijkstra's to get routing table</li>
<li>O(n^2)</li>
</ul>
</li>
</ul>
<p>bellman-ford</p>
<ul>
<li>Each node periodically sends its own distance vector estimates to neighbors</li>
<li>When a node x receives a new DV estimate from a neighbor v, uses B-F</li>
<li>Dx(y) ←minv{c(x,v)+Dv(y)} for each y ∈ N</li>
<li>The estimate Dx(y) converges to the actual dx(y) for minor, natural conditions</li>
</ul>
<h2 id="as"><a aria-hidden="true" class="anchor-heading" href="#as"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>AS</h2>
<ul>
<li>A collection of physical networks with a unif
<ul>
<li>ISP, A Corporate network, A Campus networ</li>
</ul>
</li>
<li>An AS may get an AS number (ASN)
<ul>
<li>ASNs represent units of routing policy</li>
</ul>
</li>
<li>AS can have one/many/none ASN</li>
</ul>
<h2 id="bgp"><a aria-hidden="true" class="anchor-heading" href="#bgp"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>BGP</h2>
<ul>
<li>function
<ul>
<li>Obtain network reachability information from neighboring AS</li>
<li>Propagate the reachability information to all routers internal to the AS</li>
<li>Determine “good” routes to subnets based on the reachability information and on AS policy</li>
<li>Advertise its existence to the rest of the Internet!</li>
</ul>
</li>
<li>Uses path vector routing algorithm</li>
<li>Is heavily policy-based</li>
<li>Principles of Operation
<ul>
<li>A BGP session is established between routers (TCP)</li>
<li>exchange route UPDATE messages while connection is ALIVE</li>
<li>message
<ul>
<li>open： set up session</li>
<li>keepalive: confirms liveness to neighbor</li>
<li>notificatoin: signals an error before</li>
<li>UPDATE: Primary message to communicate information about routes
<ul>
<li>Announce or withdraw routes</li>
<li>Route = prefix + path attributes</li>
</ul>
</li>
</ul>
</li>
<li>eBGP runs between ASes</li>
<li>iBGP within AS</li>
</ul>
</li>
</ul>
<p><img src="/assets/images/2021-03-25-16-16-40.png"></p>
<p><img src="/assets/images/2021-03-25-16-18-44.png"></p>
<p><img src="/assets/images/2021-03-25-16-20-16.png"></p>
<p><img src="/assets/images/2021-03-25-16-22-51.png"></p>
<p><img src="/assets/images/2021-03-25-16-28-17.png"></p>
<h2 id="dhcp"><a aria-hidden="true" class="anchor-heading" href="#dhcp"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>DHCP</h2>
<ul>
<li>Dynamic Host Configuration Protocol (IP)</li>
<li>information carried: a pool of IP addresses, a repository of network details
<ul>
<li>Provides these details upon request or by default</li>
</ul>
</li>
<li>methods of communication : broadcast, Send to 255.255.255.255, UDP, port 67</li>
<li>leases : Used for dynamic allocation, Solution for control of when an address can be given to another client
<ul>
<li>Server allows use of addr for a set period, Client will need to reacquire permission before lease period expires(automatically)</li>
</ul>
</li>
<li>message format:
<ul>
<li>type: discover, offer, request, ack, release</li>
<li>xid: Random transaction value (client 发，用于定位client)</li>
<li>chaddr: client hardware identifier</li>
<li>siaddr: server’s IP address</li>
<li>yiaddr: “your” address</li>
<li>options: lots of optional parameters</li>
</ul>
</li>
<li>the discovery process
<ul>
<li>broadcast first, Multiple servers may respond</li>
<li>Client chooses whichever offer it wishes</li>
<li>DHCP Request / Ack is repeated to renew a lease</li>
</ul>
</li>
</ul>
<h2 id="nat"><a aria-hidden="true" class="anchor-heading" href="#nat"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>NAT</h2>
<ul>
<li>Network Address Translation
<ul>
<li>router manage a subnet</li>
<li>map one address space to another</li>
</ul>
</li>
<li>benefits
<ul>
<li>Work-around to the impending exhaustion of IP addresses  </li>
<li>Also allows for simple address allocation for the subnet</li>
<li>“Security”: internal network structure obscured</li>
</ul>
</li>
<li>objections
<ul>
<li>IPv6 should be used to solve addressing problem</li>
<li>Objection 2: Violates end-to-end principle</li>
<li>Objection 3: Routers shouldn’t process packets higher than network layer</li>
<li>Objection 4: Using port numbers to address hosts</li>
</ul>
</li>
<li>operations
<ul>
<li>hosts on private network use "non-routable" ip addresses (10.0.0.0/8 172.16.0.0/16 192.168.0.0/16)</li>
<li>these addresses are not unique, restricted to the private subnet</li>
<li>Router shows a single external IP address</li>
<li>Translation table maps external IP / port combinations to internal IP / port</li>
<li>rewrite all packets in each direction, changing based on translation table
<ul>
<li>Other fixes also needed to the packet</li>
</ul>
</li>
<li>Packet Fix-up
<ul>
<li>Fix checksums</li>
<li>Router must do more than simply change address/port values</li>
</ul>
</li>
</ul>
</li>
<li>port forwarding.
<ul>
<li>NAT Address Translation Table</li>
<li>Translation table is normally initialized by internal traffic</li>
<li>Port forwarding specifies values ahead of time</li>
</ul>
</li>
</ul>
<h1 id="tool"><a aria-hidden="true" class="anchor-heading" href="#tool"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>tool</h1>
<ul>
<li>ping: send one packets and cal RTT</li>
<li>traceroute: will send 3 packets to each router it.</li>
</ul>
<hr>
<h2 id="backlinks"><a aria-hidden="true" class="anchor-heading" href="#backlinks"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Backlinks</h2>
<ul>
<li><a href="/notes/92917ea3-452e-48dc-875e-5cd0002041db">Network (my_note)</a></li>
</ul></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-4"><div><div class=""><div class="ant-anchor-wrapper" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#network-layer" title="Network Layer">Network Layer</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#ip" title="Ip">Ip</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#packet" title="Packet">Packet</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#routing" title="Routing">Routing</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#format" title="Format">Format</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#ipv4" title="Ipv4">Ipv4</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#icmp" title="Icmp">Icmp</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#forwarding-table" title="Forwarding Table">Forwarding Table</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#as" title="As">As</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#bgp" title="Bgp">Bgp</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#dhcp" title="Dhcp">Dhcp</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#nat" title="Nat">Nat</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#tool" title="Tool">Tool</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#backlinks" title="Backlinks">Backlinks</a></div></div></div></div></div></div></div></div></div></main><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></section></section></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"6b73a39d-3aee-4ff4-8d92-39736cc4b8b3","title":"Networklayer","vault":{"fsPath":"repos/dendron-aws-vault","remote":{"type":"git","url":"https://github.com/cczhong11/my_note.git"},"name":"my_note"},"type":"note","desc":"","links":[{"from":{"fname":"development.network","vaultName":"my_note"},"type":"backlink","position":{"start":{"line":8,"column":3,"offset":141},"end":{"line":8,"column":47,"offset":185},"indent":[]},"value":"development.network.networklayer"}],"anchors":{"network-layer":{"type":"header","value":"network-layer","line":8,"column":0},"ip":{"type":"header","value":"ip","line":15,"column":0},"packet":{"type":"header","value":"packet","line":27,"column":0},"routing":{"type":"header","value":"routing","line":35,"column":0},"format":{"type":"header","value":"format","line":47,"column":0},"ipv4":{"type":"header","value":"ipv4","line":69,"column":0},"icmp":{"type":"header","value":"icmp","line":85,"column":0},"forwarding-table":{"type":"header","value":"forwarding-table","line":98,"column":0},"as":{"type":"header","value":"as","line":116,"column":0},"bgp":{"type":"header","value":"bgp","line":125,"column":0},"dhcp":{"type":"header","value":"dhcp","line":158,"column":0},"nat":{"type":"header","value":"nat","line":179,"column":0},"tool":{"type":"header","value":"tool","line":209,"column":0}},"fname":"development.network.networklayer","updated":1618204145711,"created":1615775504359,"parent":"92917ea3-452e-48dc-875e-5cd0002041db","children":[],"data":{},"custom":{},"contentHash":"dbae8544c1190235cd887d0aedc1dc6b"},"body":"\u003ch1 id=\"networklayer\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#networklayer\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eNetworklayer\u003c/h1\u003e\n\u003ch1 id=\"network-layer\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#network-layer\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003enetwork layer\u003c/h1\u003e\n\u003cp\u003eip\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003etransfer packets across links\u003c/strong\u003e, addressing scale to large networks, routing protocol determines best paths across the network\u003c/p\u003e\n\u003ch2 id=\"ip\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#ip\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eIP\u003c/h2\u003e\n\u003cp\u003eaddressing mechanism: IP ADDRESS \u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eNo call setup at network layer\u003c/li\u003e\n\u003cli\u003ePackets are forwarded using address of the destination host\u003c/li\u003e\n\u003cli\u003ePackets are forwarded independently\u003c/li\u003e\n\u003cli\u003ePackets between same source-dest pair may take different paths\u003c/li\u003e\n\u003cli\u003eaddressing\n\u003cul\u003e\n\u003cli\u003eEach end-host has unique address\u003c/li\u003e\n\u003cli\u003eForwarding table maps addresses to outgoing link\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"packet\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#packet\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003epacket\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003edata types: packet\n\u003cul\u003e\n\u003cli\u003eOn sending side, encapsulate segment into packets\u003c/li\u003e\n\u003cli\u003eTransmit the packet through the network\u003c/li\u003e\n\u003cli\u003eNetwork layer protocols exist on all routers (and hosts) for this purpose\u003c/li\u003e\n\u003cli\u003eOn receiving side, deliver packets to transport layer\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"routing\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#routing\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003erouting\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eRouting (Control Plane)\n\u003cul\u003e\n\u003cli\u003e\u003cstrong\u003eInvolves all routers in a network\u003c/strong\u003e\u003c/li\u003e\n\u003cli\u003eCreates a \u003cstrong\u003eforwarding\u003c/strong\u003e table to determine end-to-end paths taken by packets\u003c/li\u003e\n\u003cli\u003eUses routing algorithms\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eForwarding (Data Plane)\n\u003cul\u003e\n\u003cli\u003eMove packets from router’s incoming interface to appropriate outgoing interface\u003c/li\u003e\n\u003cli\u003eAn action in a single router\u003c/li\u003e\n\u003cli\u003euse forwarding table\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eConnection Setup: setup route states before sending packets\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"format\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#format\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eformat\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003epacket-handling operations at each router\n\u003cul\u003e\n\u003cli\u003eforward with destination of address\u003c/li\u003e\n\u003cli\u003eforward independently\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eformat\n\u003cul\u003e\n\u003cli\u003eVersion specifies IPv4\u003c/li\u003e\n\u003cli\u003eHeader length (in 32-bit words)\u003c/li\u003e\n\u003cli\u003eType of Service\u003c/li\u003e\n\u003cli\u003eDatagram length (Header + data) 20bytes+data\u003c/li\u003e\n\u003cli\u003eID, Flags, Offset: Used for fragmentation at router\n\u003cul\u003e\n\u003cli\u003e1 DF Don't fragament\u003c/li\u003e\n\u003cli\u003e2 MF more fragament\u003c/li\u003e\n\u003cli\u003eID unique\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eTime-to-Live: Decremented at each router, Datagram dropped if zero\u003c/li\u003e\n\u003cli\u003eProtocol\n\u003cul\u003e\n\u003cli\u003eUsed by receiver to determine which transport protocol should get packet\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eHeader checksum: Calculated only on header\n\u003cul\u003e\n\u003cli\u003eMust be recomputed at each router: because ttl changes\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003euse checksum because other protocol maybe involved\u003c/li\u003e\n\u003cli\u003eData: Encapsulated TCP/UDP segment . ICMP data\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"ipv4\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#ipv4\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eipv4\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003eprefix notation: range of subnet 128.2.101.64/26\n\u003cul\u003e\n\u003cli\u003e6 bit free\u003c/li\u003e\n\u003cli\u003eexample: 223.1.17.0/25 for /24 half, 223.1.17.128/26 for 64, 223.1.17.192/26 for 64\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eforwarding tables:\n\u003cul\u003e\n\u003cli\u003eput prefix matching in destination prefix\u003c/li\u003e\n\u003cli\u003ematch the leading bits of destination address to the longest listed prefix: \u003cstrong\u003elongest matching prefix rule\u003c/strong\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eCIDR classless interdomain routing\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-03-25-16-00-27.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-03-25-16-14-19.png\"\u003e\u003c/p\u003e\n\u003ch3 id=\"icmp\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#icmp\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eICMP\u003c/h3\u003e\n\u003cul\u003e\n\u003cli\u003esingle ip packet\n\u003cul\u003e\n\u003cli\u003eno reliability\u003c/li\u003e\n\u003cli\u003etype/ code for echo/unreachable....\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003etraceroute:\n\u003cul\u003e\n\u003cli\u003esend nth udp segments has TTL of n\u003c/li\u003e\n\u003cli\u003ereplies with ICMP time exceeded\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eis a network-layer protocol\n\u003cul\u003e\n\u003cli\u003eMessages used for communication between routers and end-hosts\u003c/li\u003e\n\u003cli\u003eMessages sent in an IP packet - Just like a UDP segment\u003c/li\u003e\n\u003cli\u003eMessages require special processing by the IP layer software on each router\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3 id=\"forwarding-table\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#forwarding-table\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eforwarding table\u003c/h3\u003e\n\u003cp\u003edijkstra\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-04-11-21-58-17.png\"\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e每次更新新加入的点到未加入点的距离。每次从未加入点中选一个距离到已加入的set里\b最小的\n\u003cul\u003e\n\u003cli\u003eshort path tree\u003c/li\u003e\n\u003cli\u003euse dijkstra's to get routing table\u003c/li\u003e\n\u003cli\u003eO(n^2)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003ebellman-ford\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eEach node periodically sends its own distance vector estimates to neighbors\u003c/li\u003e\n\u003cli\u003eWhen a node x receives a new DV estimate from a neighbor v, uses B-F\u003c/li\u003e\n\u003cli\u003eDx(y) ←minv{c(x,v)+Dv(y)} for each y ∈ N\u003c/li\u003e\n\u003cli\u003eThe estimate Dx(y) converges to the actual dx(y) for minor, natural conditions\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"as\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#as\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eAS\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eA collection of physical networks with a unif\n\u003cul\u003e\n\u003cli\u003eISP, A Corporate network, A Campus networ\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAn AS may get an AS number (ASN)\n\u003cul\u003e\n\u003cli\u003eASNs represent units of routing policy\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eAS can have one/many/none ASN\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"bgp\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#bgp\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eBGP\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003efunction\n\u003cul\u003e\n\u003cli\u003eObtain network reachability information from neighboring AS\u003c/li\u003e\n\u003cli\u003ePropagate the reachability information to all routers internal to the AS\u003c/li\u003e\n\u003cli\u003eDetermine “good” routes to subnets based on the reachability information and on AS policy\u003c/li\u003e\n\u003cli\u003eAdvertise its existence to the rest of the Internet!\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eUses path vector routing algorithm\u003c/li\u003e\n\u003cli\u003eIs heavily policy-based\u003c/li\u003e\n\u003cli\u003ePrinciples of Operation\n\u003cul\u003e\n\u003cli\u003eA BGP session is established between routers (TCP)\u003c/li\u003e\n\u003cli\u003eexchange route UPDATE messages while connection is ALIVE\u003c/li\u003e\n\u003cli\u003emessage\n\u003cul\u003e\n\u003cli\u003eopen： set up session\u003c/li\u003e\n\u003cli\u003ekeepalive: confirms liveness to neighbor\u003c/li\u003e\n\u003cli\u003enotificatoin: signals an error before\u003c/li\u003e\n\u003cli\u003eUPDATE: Primary message to communicate information about routes\n\u003cul\u003e\n\u003cli\u003eAnnounce or withdraw routes\u003c/li\u003e\n\u003cli\u003eRoute = prefix + path attributes\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eeBGP runs between ASes\u003c/li\u003e\n\u003cli\u003eiBGP within AS\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-03-25-16-16-40.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-03-25-16-18-44.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-03-25-16-20-16.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-03-25-16-22-51.png\"\u003e\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/assets/images/2021-03-25-16-28-17.png\"\u003e\u003c/p\u003e\n\u003ch2 id=\"dhcp\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#dhcp\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eDHCP\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eDynamic Host Configuration Protocol (IP)\u003c/li\u003e\n\u003cli\u003einformation carried: a pool of IP addresses, a repository of network details\n\u003cul\u003e\n\u003cli\u003eProvides these details upon request or by default\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003emethods of communication : broadcast, Send to 255.255.255.255, UDP, port 67\u003c/li\u003e\n\u003cli\u003eleases : Used for dynamic allocation, Solution for control of when an address can be given to another client\n\u003cul\u003e\n\u003cli\u003eServer allows use of addr for a set period, Client will need to reacquire permission before lease period expires(automatically)\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003emessage format:\n\u003cul\u003e\n\u003cli\u003etype: discover, offer, request, ack, release\u003c/li\u003e\n\u003cli\u003exid: Random transaction value (client 发，用于定位client)\u003c/li\u003e\n\u003cli\u003echaddr: client hardware identifier\u003c/li\u003e\n\u003cli\u003esiaddr: server’s IP address\u003c/li\u003e\n\u003cli\u003eyiaddr: “your” address\u003c/li\u003e\n\u003cli\u003eoptions: lots of optional parameters\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ethe discovery process\n\u003cul\u003e\n\u003cli\u003ebroadcast first, Multiple servers may respond\u003c/li\u003e\n\u003cli\u003eClient chooses whichever offer it wishes\u003c/li\u003e\n\u003cli\u003eDHCP Request / Ack is repeated to renew a lease\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"nat\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#nat\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eNAT\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eNetwork Address Translation\n\u003cul\u003e\n\u003cli\u003erouter manage a subnet\u003c/li\u003e\n\u003cli\u003emap one address space to another\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ebenefits\n\u003cul\u003e\n\u003cli\u003eWork-around to the impending exhaustion of IP addresses  \u003c/li\u003e\n\u003cli\u003eAlso allows for simple address allocation for the subnet\u003c/li\u003e\n\u003cli\u003e“Security”: internal network structure obscured\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eobjections\n\u003cul\u003e\n\u003cli\u003eIPv6 should be used to solve addressing problem\u003c/li\u003e\n\u003cli\u003eObjection 2: Violates end-to-end principle\u003c/li\u003e\n\u003cli\u003eObjection 3: Routers shouldn’t process packets higher than network layer\u003c/li\u003e\n\u003cli\u003eObjection 4: Using port numbers to address hosts\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eoperations\n\u003cul\u003e\n\u003cli\u003ehosts on private network use \"non-routable\" ip addresses (10.0.0.0/8 172.16.0.0/16 192.168.0.0/16)\u003c/li\u003e\n\u003cli\u003ethese addresses are not unique, restricted to the private subnet\u003c/li\u003e\n\u003cli\u003eRouter shows a single external IP address\u003c/li\u003e\n\u003cli\u003eTranslation table maps external IP / port combinations to internal IP / port\u003c/li\u003e\n\u003cli\u003erewrite all packets in each direction, changing based on translation table\n\u003cul\u003e\n\u003cli\u003eOther fixes also needed to the packet\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePacket Fix-up\n\u003cul\u003e\n\u003cli\u003eFix checksums\u003c/li\u003e\n\u003cli\u003eRouter must do more than simply change address/port values\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eport forwarding.\n\u003cul\u003e\n\u003cli\u003eNAT Address Translation Table\u003c/li\u003e\n\u003cli\u003eTranslation table is normally initialized by internal traffic\u003c/li\u003e\n\u003cli\u003ePort forwarding specifies values ahead of time\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch1 id=\"tool\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#tool\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003etool\u003c/h1\u003e\n\u003cul\u003e\n\u003cli\u003eping: send one packets and cal RTT\u003c/li\u003e\n\u003cli\u003etraceroute: will send 3 packets to each router it.\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003ch2 id=\"backlinks\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#backlinks\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eBacklinks\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"/notes/92917ea3-452e-48dc-875e-5cd0002041db\"\u003eNetwork (my_note)\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e","noteIndex":{"id":"0f1b48c7-3a25-4016-83a5-15864d7803ad","title":"Development","vault":{"fsPath":"repos/dendron-aws-vault","remote":{"type":"git","url":"https://github.com/cczhong11/my_note.git"},"name":"my_note"},"type":"note","desc":"","links":[{"from":{"fname":"root","vaultName":"my_note"},"type":"backlink","position":{"start":{"line":8,"column":3,"offset":63},"end":{"line":8,"column":21,"offset":81},"indent":[]},"value":"development"}],"anchors":{},"fname":"development","updated":1618381238346,"created":1612940782409,"parent":null,"children":["400115e9-30f7-4a13-9776-db059bc9cd42","xsX5v3ZsyJ0i6gf9","1bc3b45a-b6f4-4150-87d3-5bd5b6eb8c24","6cea4852-6e7c-4140-b476-85c07b48a642","a40ef849-d301-4d74-a778-e6d9469dfb5d","09d9081f-3dff-453d-8488-7d2344cc8895","92917ea3-452e-48dc-875e-5cd0002041db","2e151826-cb22-4d89-8ce0-71dad7204ce8","baa39444-0da9-4c55-8df7-2a6f8f787fa4","62daf50d-a39e-463f-aabd-be53790281fd","3524d0a7-be73-45d6-847e-c970f5c1c760","eac0f243-05b3-4b95-bec3-848e33edbc40"],"data":{},"custom":{"nav_order":0,"permalink":"/"},"body":"\n","contentHash":"38357962f5a50c6fd7d318dfa66bea90"},"collectionChildren":null,"customHeadContent":null,"config":{"version":4,"useFMTitle":true,"useNoteTitleForLink":true,"mermaid":true,"useKatex":true,"dev":{"previewV2Enabled":false,"enablePreviewV2":true},"site":{"copyAssets":true,"siteHierarchies":["development","life"],"siteRootDir":"docs","usePrettyRefs":true,"title":"my_note","siteUrl":"https://notes.tczhong.com","description":"Personal knowledge space","siteLastModified":true,"gh_edit_branch":"main","usePrettyLinks":true,"siteNotesDir":"notes","siteFaviconPath":"favicon.ico","gh_edit_link":true,"gh_edit_link_text":"Edit this page on GitHub","gh_root":"docs/","gh_edit_view_mode":"edit","writeStubs":true,"siteIndex":"development"},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":false,"bubbleUpCreateNew":true}},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"randomNote":{}},"workspace":{"dendronVersion":"0.70.0","vaults":[{"fsPath":"repos/dendron-aws-vault","remote":{"type":"git","url":"https://github.com/cczhong11/my_note.git"},"name":"my_note"},{"fsPath":"vault"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"graph":{"zoomSpeed":1},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableUserTags":true,"enableHashTags":true,"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"}},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"6b73a39d-3aee-4ff4-8d92-39736cc4b8b3"},"buildId":"qHbm4vS5s7hFBo6UvcS91","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>